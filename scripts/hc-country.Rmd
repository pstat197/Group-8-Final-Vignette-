---
title: "Hierarchical Clustering Analysis on Country Data"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      fig.align = 'center',
                      cache = TRUE)
```

## References

- Hierarchucal clustering background
    - [ISLR Textbook](https://trevorhastie.github.io/ISLR/ISLR%20Seventh%20Printing.pdf)
- `hclust()` function
    - [Using the `hclust()` function](https://r-charts.com/part-whole/hclust/)
    - [Customization for `hclust()`](https://stackoverflow.com/questions/55207216/r-rect-hclust-rectangles-too-high-in-dendogram)
- Determining the optimal number of clusters
    - [Using the `fviz_nbclust()` and `fviz_gap_stat()` functions](https://rpkgs.datanovia.com/factoextra/reference/fviz_nbclust.html)
    - [Explanation](https://www.datanovia.com/en/lessons/determining-the-optimal-number-of-clusters-3-must-know-methods/#elbow-method)
- Dataset
    - [Country Data](https://www.kaggle.com/datasets/rohan0301/unsupervised-learning-on-country-data)

## Task

(Directly from the [Kaggle description](https://www.kaggle.com/datasets/rohan0301/unsupervised-learning-on-country-data))

**Objective:**

To categorise the countries using socio-economic and health factors that determine the overall development of the country.

**About organization:**

HELP International is an international humanitarian NGO that is committed to fighting poverty and providing the people of backward countries with basic amenities and relief during the time of disasters and natural calamities.

**Problem Statement:**

HELP International have been able to raise around $ 10 million. Now the CEO of the NGO needs to decide how to use this money strategically and effectively. So, CEO has to make decision to choose the countries that are in the direst need of aid. Hence, your Job as a Data scientist is to categorise the countries using some socio-economic and health factors that determine the overall development of the country. Then you need to suggest the countries which the CEO needs to focus on the most.

## Loading the data

```{r, message=FALSE}
# load packages
library(tidyverse)
library(dendextend)
library(factoextra)

# read data
countries <- read.csv("../data/country-data.csv")

df <- countries %>%
  column_to_rownames(var = "country")
```

## Making a dendrogram

```{r, fig.height=20}
df %>%
  scale() %>%
  dist() %>%
  hclust() %>%
  as.dendrogram() %>%
  set("labels_cex", 0.4) %>%
  plot(horiz = TRUE)
```

## Determining the optimal number of clusters

**Elbow method**

- Looks at the total within-cluster sum of squares (WSS)
- Similar to proportion of variance explained (PVE) plot in PCA
- The optimal number of clusters is the point where the plot appears to bend
- Lower WSS = better

```{r}
# best = 4 clusters (not much improvement after 4 clusters)
fviz_nbclust(df, 
             hcut, 
             method = "wss")
```

**Average silhouette method**

- Determines how well each object lies within its cluster
- Higher average silhouette = better

```{r}
# best = 2 clusters
fviz_nbclust(df, 
             hcut, 
             method = "silhouette")
```

**Gap statistic method**

- Compares the total within intra-cluster variation for different values of $k$ with randomly drawn samples
- Choose $k$ such that the gap statistic is within 1 standard deviation of the gap statistic at $k + 1$
- Higher gap statistic = better

```{r}
library(cluster)
set.seed(123)
gap_stat <- clusGap(df,
                    hcut,
                    K.max = 10, # number of clusters to consider
                    B = 500)    # number of samples to bootstrap

# best = 3 clusters
fviz_gap_stat(gap_stat)
```

## Showing the clusters

$k = 3$ clusters

```{r, fig.height=20}
df %>%
  scale() %>%
  dist() %>%
  hclust() %>%
  as.dendrogram() %>%
  set("labels_cex", 0.4) %>%
  color_branches(k = 2) %>% 
  color_labels(k = 2) %>%
  plot(horiz = TRUE)
```

$k = 3$ clusters

```{r, fig.height=20}
df %>%
  scale() %>%
  dist() %>%
  hclust() %>%
  as.dendrogram() %>%
  set("labels_cex", 0.4) %>%
  color_branches(k = 3) %>% 
  color_labels(k = 3) %>%
  plot(horiz = TRUE)
```

$k = 4$ (notice how Nigeria is in its own group)

```{r, fig.height=20}
df %>%
  scale() %>%
  dist() %>%
  hclust() %>%
  as.dendrogram() %>%
  set("labels_cex", 0.4) %>%
  color_branches(k = 4) %>% 
  color_labels(k = 4) %>%
  plot(horiz = TRUE)
```
